define(function(){var name="mokuso",_=new(kendo.Class.extend({isArray:function(e){return e&&$.isArray(e)?!0:e&&kendo.isFunction(e.shift)&&kendo.isFunction(e.slice)?!0:!1},isObservableObject:function(e){return e&&"string"==$.type(e.uid)&&kendo.isFunction(e.get)&&kendo.isFunction(e.set)?!0:!1},handleModuleHook:function(e,n,t){for(var i=[],o=0;o<n.length;o++)$.isFunction(n[o][t])&&i.push(n[o][t](e));return $.when(i)},render:function(e,n,t){e.model.preinit(n,t);var i=n.parents("*[data-role='"+name+"view']:first").data(name+"View");i&&i instanceof kendo.Layout?i.showIn(e,n):e.render(n)},getView:function(e){return $.ajax({url:require.toUrl("view/"+e+".html")}).promise()},go:function(_node,_page,_args){if(!("string"!=$.type(_page)||$.trim(_page).length<=0||"object"!=$.type(_node))){var _def=$.Deferred(),qIdx=_page.indexOf("?"),page=qIdx>0?_page.substring(0,qIdx):_page,args=this.isObservableObject(_args)?_args:new kendo.data.ObservableObject($.isPlainObject(_args)?_args:{}),node=_node;_node instanceof $||(node=$(_node));var inlineViews=node.find("*[data-role='"+name+"view']");node.data(name+"View")&&inlineViews.push(node);var def=null;if(inlineViews.length){var ___def=$.Deferred();def=$.Deferred();var __def=$.map(inlineViews,function(e){var n=$(e);return{depth:n.parents().length,node:n}}).sort(function(e,n){return n.depth-e.depth}).reduce(function(e,n){return e.then(function(){return n.node.data(name+"View").model.deinit(n.node)})},___def);__def.always(function(){node.data(name+"View").destroy(),node.empty()}).always(function(){return _.getView(page).fail(function(e){def.rejectWith(null,[e])}).then(function(e){def.resolveWith(null,[e])})}),___def.resolve()}else def=_.getView(page);return require(["viewmodel/"+page],function(modelview){def.then(function(view){var kendoView=new kendo.View("<div>"+view+"</div>",{model:kendo.observable($.extend(!0,{preinit:function(){},init:function(){},deinit:function(){}},modelview)),init:function(){var self=this,node=this.element.parent();node.attr("data-role",name+"view"),node.attr("data-view",page),$.when(this.model.init(this.element,args)).always(function(){var _model=self.model,_element=self.element,_defs=[];_element.find("*[data-role='"+name+"view']").each(function(i,n){var _n=$(n),_args=new kendo.data.ObservableObject({});if($.trim(_n.attr("data-view-args")).length)with(_model){var arrBindFields=[],__args={};try{eval("__args = "+_n.attr("data-view-args"))}catch(ex){console.error("Argument Parsing Error","Could not parse inline page arguments: "+_n.attr("data-view-args"))}for(var fProp in __args){var _type=$.type(__args[fProp]);if("string"==_type||"number"==_type||"object"==_type)_args.set(fProp,__args[fProp]);else for(var tProp in _model)if(__args[fProp]===_model[tProp]){arrBindFields.push({f:fProp,t:tProp}),_args.set(fProp,_model.get(tProp));break}}arrBindFields.length&&_model.bind("change",function(e){for(var n=0;n<arrBindFields.length;n++)if(arrBindFields[n].t==e.field){_args.set(arrBindFields[n].t,this.get(e.field));break}})}_defs.push(_.go(_n,_n.attr("data-view"),_args))}),$.when.apply($,_defs).then(function(){_def.resolve()}).fail(function(){_def.rejectWith(null,arguments)})})},wrap:!1});node.data(name+"View",kendoView),_.render(kendoView,node,args)}).fail(function(){_def.rejectWith(null,arguments)})},function(){_def.rejectWith(null,arguments)}),_def}}})),Class=kendo.Class.extend({options:{},events:$(["init","before-route","after-route"]),router:null,mobileApp:null,modules:[],init:function(e,n,t){var i=this;this.options=$.extend({node:$("body"),initial:null,init:null,transition:null,root:"/",pushState:!1,hashBang:!1,modules:[]},n),e&&(this.options.node=e);for(var o=0;o<this.options.modules.length;o++)this.registerModule(this.options.modules[o]);_.handleModuleHook(this,this.modules,"beforeInit").then(function(){if(t&&kendo.mobile&&kendo.mobile.Application){var e=null;return"string"==$.type(i.options.initial)&&$.trim(i.options.initial).length>0?e=i.load(i.options.node,n.initial).then(function(){var e=$("*[data-role='"+name+"view']:first").data(name+"View").element;e.find("*[data-role='"+name+"view']").each(function(){var n=$(this),t=n.data(name+"View");t.element.children("[data-role]").each(function(){var n=$(this);n.data(name+"View",t),e.append(n)})})}).then(function(){i.options.initial=null,i.mobileApp=new kendo.mobile.Application($("*[data-role='"+name+"view']:first").data(name+"View").element,i.options)}):(i.options.initial=null,i.mobileApp=new kendo.mobile.Application(i.options.node,i.options)),$.when(e).then(function(){i.router=i.mobileApp.router,i.router.bind("change",function(e){i.trigger("before-route",[e.url,i.options.node]),setTimeout(function(){i.trigger("after-route",[e.url,i.options.node])})})})}i.router=new kendo.Router({pushState:i.options.pushState,hashBang:i.options.hasBang,root:i.options.root}),i.router.route("*page",function(e,n){_.handleModuleHook(i,i.modules,"beforeRoute").then(function(){i.trigger("before-route",[e,i.options.node]),_.go(i.options.node,e,n).fail(function(e){i.router.trigger("routeMissing",e)}).then(function(){i.events.trigger("after-route",[e,i.options.node])})}).then(function(){return _.handleModuleHook(i,i.modules,"afterRoute")})});var o=location.href.indexOf("#");$.trim(i.options.initial).length&&(0>o||o==location.href.length-1)&&(location.href=0>o?location.href+"#"+i.options.initial:location.href.substring(0,o)+"#"+i.options.initial),$.isFunction(i.options.init)&&i.options.init()}).then(function(){return _.handleModuleHook(i,i.modules,"afterInit").then(function(){i.router.start()})})},registerModule:function(e){e instanceof Class.Module&&0==$.grep(this.modules,function(n){return e===n}).length?this.modules.push(e):console.error("Module is not an extension of "+name+".Module")},deregisterModule:function(e){e instanceof Class.Module&&$.grep(this.modules,function(n){return e===n}).length>=1?this.modules=$.grep(function(n){return e!==n}):console.error("Module is not an extension of "+name+".Module")},navigate:function(e){return this.router?"string"==$.type(e)&&$.trim(e).length>0?this.mobileApp?this.mobileApp.navigate.apply(this.mobileApp,arguments):this.router.navigate.apply(this.router,arguments):void console.error("Arguments Exception","Page is empty; Usage: navigate(String page)"):void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)")},replace:function(e){return this.router?"string"==$.type(e)&&$.trim(e).length>0?this.mobileApp?this.mobileApp.replace.apply(this.mobileApp,arguments):this.router.replace.apply(this.router,arguments):void console.error("Arguments Exception","Page is empty; Usage: replace(String page)"):void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)")},load:function(e,n,t){return"string"==$.type(n)&&$.trim(n).length>0&&"object"==$.type(e)?_.go(e,n,t):void console.error("Arguments Exception","Page is empty or node is not a DOM element; Usage: load(String page, DomNode node)")},showLoading:function(){this.mobileApp?this.mobileApp.showLoading():kendo.ui.progress(this.options.node,!0)},hideLoading:function(){kendo.ui.progress(this.options.node,!1),this.mobileApp&&this.mobileApp.hideLoading()},bind:function(e,n){"string"==$.type(e)&&$.trim(e).length>0&&$.isFunction(n)?this.mobileApp?this.mobileApp.bind.apply(this.mobileApp,arguments):this.events.bind.apply(this.events,arguments):console.error("Arguments Exception","Event is empty or method is not a function; Usage: bind(String event, Function method, ...)")},trigger:function(e){"string"==$.type(e)&&$.trim(e).length>0?this.mobileApp?this.mobileApp.trigger.apply(this.mobileApp,arguments):this.events.trigger.apply(this.events,arguments):console.error("Arguments Exception","Event is empty ; Usage: bind(String event, ...)")}});return kendo.isArray=_.isArray,kendo.isObservableObject=_.isObservableObject,kendo.mobile&&(kendo.mobile.isArray=_.isArray,kendo.mobile.isObservableObject=_.isObservableObject),Class.Module=kendo.Class.extend({beforeInit:function(){},afterInit:function(){},beforeRoute:function(){},afterRoute:function(){}}),Class});