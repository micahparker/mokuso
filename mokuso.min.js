define(function(){var t="mokuso",n=new(kendo.Class.extend({isArray:function(n){return n&&$.isArray(n)?!0:n&&kendo.isFunction(n.shift)&&kendo.isFunction(n.slice)?!0:!1},isObservableObject:function(n){return n&&$.type(n.uid)=="string"&&kendo.isFunction(n.get)&&kendo.isFunction(n.set)?!0:!1},handleModuleHook:function(n,t,i){for(var u=[],r=0;r<n.length;r++)$.isFunction(n[r][t])&&u.push(n[r][t].apply(n[r][t],i||[]));return $.when.apply(null,u)},render:function(n,i){var r=i.parents("*[data-role='"+t+"view']:first").data(t+"View");r&&r instanceof kendo.Layout?r.showIn(n,i):n.render(i)},getView:function(n){return $.ajax({url:require.toUrl("view/"+n+".html")}).promise()},findNestedViews:function(i,r,u){var f=[];return i.find("*[data-role='"+t+"view']").addBack("*[data-role='"+t+"view']").each(function(t,i){var _n,s,o,h,e,c,l;if(console.log(i),_n=$(i),s=new kendo.data.ObservableObject({}),$.trim(_n.attr("data-view-args")).length){if(o=[],h={},r)with(r)try{eval("__args = "+_n.attr("data-view-args"))}catch(a){console.error("Argument Parsing Error","Could not parse inline page arguments: "+_n.attr("data-view-args"))}for(e in h)if(c=$.type(h[e]),c=="string"||c=="number"||c=="object")s.set(e,h[e]);else for(l in r)if(h[e]===r[l]){o.push({f:e,t:l});s.set(e,r.get(l));break}o.length&&r.bind("change",function(n){for(var t=0;t<o.length;t++)if(o[t].t==n.field){s.set(o[t].t,this.get(n.field));break}})}f.push(n.go(_n,_n.attr("data-view"),s,u,u))}),$.when.apply($,f)},go:function(r,u,f,e,o){var v,c,y,w;if($.type(u)=="string"&&!($.trim(u).length<=0)&&$.type(r)=="object"){var h=$.Deferred(),p=u.indexOf("?"),l=p>0?u.substring(0,p):u,a=this.isObservableObject(f)?f:new kendo.data.ObservableObject($.isPlainObject(f)?f:{}),s=r;return r instanceof $||(s=$(r)),v=s.find("*[data-role='"+t+"view']"),s.data(t+"View")&&v.push(s),c=null,v.length?(y=$.Deferred(),c=$.Deferred(),w=$.map(v,function(n){var t=$(n);return{depth:t.parents().length,node:t}}).sort(function(n,t){return t.depth-n.depth}).reduce(function(n,i){return n.then(function(){return i.node.data(t+"View").model.deinit(i.node)})},y),w.always(function(){s.data(t+"View").destroy();s.empty()}).always(function(){return n.getView(l).fail(function(n){c.rejectWith(null,[n])}).then(function(n){c.resolveWith(null,[n])})}),y.resolve()):c=n.getView(l),require(["viewmodel/"+l],function(r){var u=kendo.observable($.extend(!0,{preinit:function(){},init:function(){},__________init:function(n){return this.init(n.view.element,n.sender.params)},deinit:function(){}},r));c.then(function(r){var f,c,v;return o?(f=$(r),c="a"+kendo.guid().replace(new RegExp("-","g"),""),i.GlobalMobileModels[c]=u,f.each(function(){var i=$(this),n,r;(i.attr("data-role")||"").toLowerCase()=="view"&&(i.attr("data-model",t+".GlobalMobileModels."+c),n=(i.attr("data-bind")||"").replace(new RegExp("events([ ]{0,}):([ ]{0,}){","i"),"events:{"),r=n.indexOf("events:{"),r>-1?i.attr("data-bind",n.substring(0,r+8)+" init: __________init, "+n.substring(r+8,n.length)):i.attr("data-bind",$.merge(n.length?n.split(","):[],["events: { init: __________init }"]).join(",")))}),$.when(u.preinit(s,a)).then(function(){var t=f.insertAfter(s);return n.findNestedViews(t,u,!1).then(function(){h.resolve()}).fail(function(){h.rejectWith(null,arguments)})})):(v=new kendo.View("<div>"+r+"<\/div>",{model:u,init:function(){var i=this,r=this.element.parent();r.attr("data-role",t+"view");r.attr("data-view",l);$.when(this.model.init(this.element,a)).always(function(){n.findNestedViews(i.element,i.model,e).then(function(){h.resolve()}).fail(function(){h.rejectWith(null,arguments)})})},wrap:!1}),s.data(t+"View",v),$.when(u.preinit(s,a)).then(function(){n.render(v,s,a)}))}).fail(function(){h.rejectWith(null,arguments)})},function(){h.rejectWith(null,arguments)}),h}}})),i=kendo.Class.extend({options:{},events:["init","before-navigate","after-navigate","before-load","after-load"],router:null,mobileApp:null,modules:[],_events:$({}),init:function(i,r,u){var f=this,e;for(this.options=$.extend({node:$("body"),initial:null,init:null,transition:null,root:"/",pushState:!1,hashBang:!1,modules:[]},r),i&&(this.options.node=i),e=0;e<this.options.modules.length;e++)this.registerModule(this.options.modules[e]);n.handleModuleHook(this.modules,"beforeInit",[this]).then(function(){var e,i;if(u&&kendo.mobile&&kendo.mobile.Application)return e=$.Deferred(),$.type(f.options.initial)=="string"&&$.trim(f.options.initial).length>0?f.load(f.options.node,r.initial,{},!0).then(function(){f.options.node.prepend($("*[data-role='"+t+"view']:first").data(t+"View").element.children());f.mobileApp=new kendo.mobile.Application(f.options.node,$.extend($.extend({},f.options),{initial:null,init:function(){setTimeout(function(){e.resolve()},10)}}))}):f.mobileApp=new kendo.mobile.Application(f.options.node,$.extend($.extend({},f.options),{init:function(){setTimeout(function(){e.resolve()},10)}})),$.when(e).then(function(){f.router=f.mobileApp.router;f.router.bind("change",function(n){f.trigger("before-navigate",[n.url,f.options.node]);setTimeout(function(){f.trigger("after-navigate",[n.url,f.options.node])},10)})});f.router=new kendo.Router({pushState:f.options.pushState,hashBang:f.options.hasBang,root:f.options.root});f.router.route("*page",function(t,i){n.handleModuleHook(f.modules,"beforeNavigate",[f.options.node,t,i]).then(function(){f.trigger("before-navigate",[t,f.options.node]);n.go(f.options.node,t,i).fail(function(n){f.router.trigger("routeMissing",n)}).then(function(){f.trigger("after-navigate",[t,f.options.node])})}).then(function(){return n.handleModuleHook(f.modules,"afterNavigate",[f.options.node,t,i])})});i=location.href.indexOf("#");$.trim(f.options.initial).length&&(i<0||i==location.href.length-1)&&(location.href=i<0?location.href+"#"+f.options.initial:location.href.substring(0,i)+"#"+f.options.initial)}).then(function(){return n.handleModuleHook(f.modules,"afterInit",[f]).then(function(){f.mobileApp||f.router.start();$.isFunction(f.options.init)&&f.options.init(f)})})},registerModule:function(n){n instanceof i.Module&&$.grep(this.modules,function(t){return n===t}).length==0?this.modules.push(n):console.error("Module is not an extension of "+t+".Module")},deregisterModule:function(n){n instanceof i.Module&&$.grep(this.modules,function(t){return n===t}).length>=1?this.modules=$.grep(function(t){return n!==t}):console.error("Module is not an extension of "+t+".Module")},navigate:function(n){if(!this.router){console.error("App not initialized: call initialize(DomNode contentNode, JSON options)");return}if($.type(n)=="string"&&$.trim(n).length>0)return this.mobileApp?this.mobileApp.navigate.apply(this.mobileApp,arguments):this.router.navigate.apply(this.router,arguments);console.error("Arguments Exception","Page is empty; Usage: navigate(String page)")},replace:function(n){if(!this.router){console.error("App not initialized: call initialize(DomNode contentNode, JSON options)");return}if($.type(n)=="string"&&$.trim(n).length>0)return this.mobileApp?this.mobileApp.replace.apply(this.mobileApp,arguments):this.router.replace.apply(this.router,arguments);console.error("Arguments Exception","Page is empty; Usage: replace(String page)")},load:function(t,i,r){var u=this,f=arguments;if($.type(i)=="string"&&$.trim(i).length>0&&$.type(t)=="object")return n.handleModuleHook(this.modules,"beforeLoad",[t,i,r]).then(function(){return u.trigger("before-load",[t,i,r]),n.go.apply(n,f)}).then(function(){return n.handleModuleHook(u.modules,"afterLoad",[t,i,r]).then(function(){u.trigger("after-load",[t,i,r])})});console.error("Arguments Exception","Page is empty or node is not a DOM element; Usage: load(String page, DomNode node)")},showLoading:function(){this.mobileApp?this.mobileApp.showLoading():kendo.ui.progress(this.options.node,!0)},hideLoading:function(){kendo.ui.progress(this.options.node,!1);this.mobileApp&&this.mobileApp.hideLoading()},bind:function(n,t){$.type(n)=="string"&&$.trim(n).length>0&&$.isFunction(t)?this.mobileApp?this.mobileApp.bind.apply(this.mobileApp,arguments):this._events.bind.apply(this._events,arguments):console.error("Arguments Exception","Event is empty or method is not a function; Usage: bind(String event, Function method, ...)")},trigger:function(n){$.type(n)=="string"&&$.trim(n).length>0?this.mobileApp?this.mobileApp.trigger.apply(this.mobileApp,arguments):this._events.trigger.apply(this._events,arguments):console.error("Arguments Exception","Event is empty ; Usage: bind(String event, ...)")}});return kendo.isArray=n.isArray,kendo.isObservableObject=n.isObservableObject,kendo.mobile&&(kendo.mobile.isArray=n.isArray,kendo.mobile.isObservableObject=n.isObservableObject),i.Module=kendo.Class.extend({beforeInit:function(){},afterInit:function(){},beforeNavigate:function(){},afterNavigate:function(){},beforeLoad:function(){},afterLoad:function(){}}),i.GlobalMobileModels={},window[t]=i,i});