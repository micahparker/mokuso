!function () { var _ = new (kendo.Class.extend({ isArray: function (e) { return e && $.isArray(e) ? !0 : e && kendo.isFunction(e.shift) && kendo.isFunction(e.slice) ? !0 : !1 }, isObservableObject: function (e) { return e && "string" == $.type(e.uid) && kendo.isFunction(e.get) && kendo.isFunction(e.set) ? !0 : !1 }, handleModuleHook: function (e, n, t) { for (var r = [], o = 0; o < e.length; o++) $.isFunction(e[o][n]) && r.push(e[o][n].apply(e[o][n], t || [])); return $.when.apply(null, r) }, findNestedViews: function (_node, _parentModel, _renderer) { var _defs = []; return _node.find("*[data-role='mokusoview']").addBack("*[data-role='mokusoview']").each(function (i, n) { var _n = $(n), _view = _n.attr("data-view"), _args = new kendo.data.ObservableObject({}); if ($.trim(_n.attr("data-view-args")).length) { var arrBindFields = [], __args = {}; if (_parentModel) with (_parentModel) try { eval("__args = " + _n.attr("data-view-args")) } catch (ex) { console.error("Argument Parsing Error", "Could not parse inline page arguments: " + _n.attr("data-view-args")) } for (var fProp in __args) { var _type = $.type(__args[fProp]); if ("string" == _type || "number" == _type || "object" == _type) _args.set(fProp, __args[fProp]); else for (var tProp in _parentModel) if (__args[fProp] === _parentModel[tProp]) { arrBindFields.push({ f: fProp, t: tProp }), _args.set(fProp, _parentModel.get(tProp)); break } } arrBindFields.length && _parentModel.bind("change", function (e) { for (var n = 0; n < arrBindFields.length; n++) if (arrBindFields[n].t == e.field) { _args.set(arrBindFields[n].t, this.get(e.field)); break } }) } _defs.push(_renderer.render(_n, _view, _args)) }), $.when.apply($, _defs) }, createRenderer: function (e, n, t) { var r = $.type(e); if ("function" == r) { var e = new e(n, t); if (e instanceof _renderer) return e } else if ("string" == $.type(e)) switch (e.toLowerCase()) { case "kendomobile": return new _renderer_KendoMobile(n, t); case "react": return new _renderer_React(n, t); case "knockout": return new _renderer_Knockout(n, t) } return new _renderer_Kendo(n, t) }, createResolver: function (e, n) { var t = $.type(e); if ("function" == t) { var e = new e(n); if (e instanceof _resolver) return e } else if ("string" == $.type(e)) switch (e.toLowerCase()) { case "browserify": return new _renderer_Browserify(n) } return new _resolver_RequireJS(n) } })), _renderer = kendo.Class.extend({ options: {}, resolver: null, init: function (e, n) { this.options = e, this.resolver = n }, render: function (e, n, t) { }, destroy: function (e) { } }), _renderer_Kendo = _renderer.extend({ render: function (e, n, t) { if (!("string" != $.type(n) || $.trim(n).length <= 0 || "object" != $.type(e))) { var r = this, o = $.Deferred(), i = n.indexOf("?"), s = i > 0 ? n.substring(0, i) : n, a = _.isObservableObject(t) ? t : new kendo.data.ObservableObject($.isPlainObject(t) ? t : {}), l = e; e instanceof $ || (l = $(e)); var d = r.resolver.resolve(r.options.paths.view + "/" + s + ".html"); return this.resolver.resolve(this.options.paths.viewmodel + "/" + s + ".js").then(function (e) { var n = kendo.observable($.extend(!0, { preinit: function (e, n) { }, init: function (e, n) { }, __________init: function (e) { return this.init(e.view.element, e.sender.params) }, deinit: function (e) { } }, e)); d.then(function (e) { return r._wireTogether(l, s, a, e, n, o) }).fail(function () { o.rejectWith(null, arguments) }) }).fail(function () { o.rejectWith(null, arguments) }), o } }, destroy: function (e) { var n = null, t = e.find("*[data-role='mokusoview']"); if (e.data("mokusoView") && t.push(e), t.length) { var r = $.Deferred(); n = $.Deferred(); var o = $.map(t, function (e) { var n = $(e); return { depth: n.parents().length, node: n } }).sort(function (e, n) { return n.depth - e.depth }).reduce(function (e, n, t, r) { return e.then(function () { return n.node.data("mokusoView").model.deinit(n.node) }) }, r); o.then(function () { e.data("mokusoView").destroy(), e.empty(), n.resolve() }).fail(function () { n.reject() }), r.resolve() } return null == n && (n = $.Deferred().resolve()), n }, _initView: function (e, n) { var t = this; return $.when(e.model.init(e.element, n)).then(function () { return _.findNestedViews(e.element.children(), e.model, t) }) }, _wireTogether: function (e, n, t, r, o, i) { var s = this, a = new kendo.View("<div>" + r + "</div>", { model: o, init: function () { this.element.data("mokusoView", this), this.element.attr("data-role", "mokusoview"), this.element.attr("data-view", n) }, show: function (e) { return s.options.transition && e.sender.element.closest(s.options.node).length && e.sender.element.siblings("[data-role=mokusoview]").length ? void 0 : s._initView(this, t).then(function () { i.resolve() }).fail(function () { i.rejectWith(null, arguments) }) }, transitionStart: function (n) { n.sender.element.data("_prevHeight", n.sender.element.css("height")).data("_prevWidth", n.sender.element.css("width")), n.sender.element.height(e.height()).width(e.width()) }, transitionEnd: function (e) { if (e.sender.element.css("height", e.sender.element.data("_prevHeight")).css("width", e.sender.element.data("_prevWidth")), "hide" != e.type || e.sender.___destroying) { if ("show" == e.type && s.options.transition) { var n = this; setTimeout(function () { s._initView(n, t).then(function () { i.resolve() }).fail(function () { i.rejectWith(null, arguments) }) }, 250) } } else e.sender.___destroying = !0, setTimeout(function () { s.destroy(e.sender.element) }, 250) }, hide: function (e) { e.sender.___destroying || (e.sender.___destroying = !0, s.destroy(e.sender.element)) }, wrap: !1 }); return $.when(o.preinit(e, t)).then(function () { e.removeAttr("data-role"), e.removeAttr("data-view"), e.removeAttr("data-view-args"); var n = e.parents("*[data-role^='mokuso']:first").data("mokusoLayout"); n instanceof kendo.Layout ? n.showIn("#mokusoLayoutNode", a, s.options.transition) : a.render(e) }) } }), _renderer_KendoMobile = _renderer_Kendo.extend({ _firstGo: !0, _wireTogether: function (e, n, t, r, o, i) { var s = this; if (0 == this._firstGo) { var a = $(r), l = "a" + kendo.guid().replace(new RegExp("-", "g"), ""); return Class.GlobalMobileModels[l] = o, a.each(function (e) { var n = $(this), t = $.trim(n.attr("data-role") || "").toLowerCase(); if (t.length && (n.attr("data-model", "mokuso.GlobalMobileModels." + l), "view" == t)) { var r = (n.attr("data-bind") || "").replace(new RegExp("events([ ]{0,}):([ ]{0,}){", "i"), "events:{"), o = r.indexOf("events:{"); o > -1 ? n.attr("data-bind", r.substring(0, o + 8) + " init: __________init, " + r.substring(o + 8, r.length)) : n.attr("data-bind", $.merge(r.length ? r.split(",") : [], ["events: { init: __________init }"]).join(",")) } }), $.when(o.preinit(e, t)).then(function () { var n = a.insertAfter(e); return _.findNestedViews(n, o, s).then(function () { i.resolve() }).fail(function () { i.rejectWith(null, arguments) }) }) } return this._firstGo = !1, _renderer_Kendo.fn._wireTogether.apply(s, arguments) } }), _renderer_React = _renderer.extend({ render: function (e, n, t) { var r = $.Deferred(); return this.resolver.resolve(this.options.paths.view + "/" + n + ".js").then(function (n) { React.unmountComponentAtNode(e[0]), React.render(n, e[0], function () { r.resolve() }) }).fail(function () { r.rejectWith(null, arguments) }), r } }), _renderer_Knockout = _renderer.extend({ render: function (e, n, t) { var r = $.Deferred(); return $.when(this.resolver.resolve(this.options.paths.view + "/" + n + ".html"), this.resolver.resolve(this.options.paths.viewmodel + "/" + n + ".js")).then(function (n, t) { for (var r in t) _.isArray(t[r]) ? t[r] = ko.observableArray(t[r]) : $.isFunction(t[r]) || (t[r] = ko.observable(t[r])); ko.cleanNode(e[0]), e.html(n), ko.applyBindings(t, e[0]) }).fail(function () { r.rejectWith(null, arguments) }), r } }); _resolver = kendo.Class.extend({ options: null, init: function (e) { this.options = e }, resolve: function (e) { throw "resolver didnt provide a resolve method." } }), _resolver_JQuery = _resolver.extend({ resolve: function (e) { var n = null; return n = e.match("js$") ? $.ajax({ url: e, dataType: "script" }).promise() : $.ajax({ url: e }).promise() } }), _resolver_RequireJS = _resolver.extend({ resolve: function (e) { var n = null; return e.match("js$") ? (n = $.Deferred(), require([e.replace(new RegExp(".js$"), "")], function (e) { n.resolveWith(null, [e]) }, function () { n.rejectWith(null, arguments) })) : n = $.ajax({ url: require.toUrl(e) }).promise(), n } }), _resolver_Browserify = _resolver.extend({ resolve: function (e) { var n = null; return n = e.match(".js$") ? $.Deferred().resolveWith(null, [require(e.replace(new RegExp(".js$"), ""))]) : $.ajax({ url: e }).promise() } }); var Class = kendo.Class.extend({ options: {}, events: ["init", "before-navigate", "after-navigate", "before-load", "after-load"], router: null, mobileApp: null, modules: [], _events: $({}), _renderer: null, _resolver: null, init: function (e, n, t) { var r = this; this.options = $.extend({ node: $("body"), initial: null, init: null, transition: "swap", root: "/", pushState: !1, hashBang: !1, modules: [], paths: { view: "view", viewmodel: "viewmodel" }, renderer: "kendo", resolver: "requirejs" }, n), e && (e instanceof $ || (e = $(e)), this.options.node = e); for (var o = 0; o < this.options.modules.length; o++) this.registerModule(this.options.modules[o]); r._resolver = _.createResolver(r.options.resolver, r.options), r._renderer = _.createRenderer(r.options.renderer, r.options, r._resolver), _.handleModuleHook(this.modules, "beforeInit", [this]).then(function () { if (t && kendo.mobile && kendo.mobile.Application) { var o = $.Deferred(); return "string" == $.type(r.options.initial) && $.trim(r.options.initial).length > 0 ? r.load(r.options.node, n.initial, {}, _.createRenderer("kendomobile", r.options, r._resolver)).then(function () { r.options.node.prepend($("*[data-role='mokusoview']:first").data("mokusoView").element.children()), r.mobileApp = new kendo.mobile.Application(r.options.node, $.extend($.extend({}, r.options), { initial: null, init: function () { setTimeout(function () { o.resolve() }, 10) } })) }) : r.mobileApp = new kendo.mobile.Application(r.options.node, $.extend($.extend({}, r.options), { init: function () { setTimeout(function () { o.resolve() }, 10) } })), $.when(o).then(function () { r.router = r.mobileApp.router, r.router.bind("change", function (e) { r.trigger("before-navigate", [e.url, r.options.node]), setTimeout(function () { r.trigger("after-navigate", [e.url, r.options.node]) }, 10) }) }) } r.router = new kendo.Router({ pushState: r.options.pushState, hashBang: r.options.hasBang, root: r.options.root }), r.router.route("*page", function (e, n) { _.handleModuleHook(r.modules, "beforeNavigate", [r.options.node, e, n]).then(function () { r.trigger("before-navigate", [e, r.options.node]), $.when(r._renderer.render(r.options.node, e, n)).fail(function (e) { r.router.trigger("routeMissing", e) }).then(function () { r.trigger("after-navigate", [e, r.options.node]) }) }).then(function () { return _.handleModuleHook(r.modules, "afterNavigate", [r.options.node, e, n]) }) }); var i = new kendo.Layout("<div id='mokusoLayoutNode'></div>", { wrap: !1 }); i.render(e), r.options.node = e.find("#mokusoLayoutNode"), e.attr("data-role", "mokusolayout"), e.data("mokusoLayout", i); var s = location.href.indexOf("#"); $.trim(r.options.initial).length && (0 > s || s == location.href.length - 1) && (0 > s ? location.href = location.href + "#" + r.options.initial : location.href = location.href.substring(0, s) + "#" + r.options.initial) }).then(function () { return _.handleModuleHook(r.modules, "afterInit", [r]).then(function () { r.mobileApp || r.router.start(), $.isFunction(r.options.init) && r.options.init(r) }) }) }, registerModule: function (e) { e instanceof Class.Module && 0 == $.grep(this.modules, function (n) { return e === n }).length ? this.modules.push(e) : console.error("Module is not an extension of mokuso.Module") }, deregisterModule: function (e) { e instanceof Class.Module && $.grep(this.modules, function (n) { return e === n }).length >= 1 ? this.modules = $.grep(function (n) { return e !== n }) : console.error("Module is not an extension of mokuso.Module") }, navigate: function (e, n) { return this.router ? "string" == $.type(e) && $.trim(e).length > 0 ? this.mobileApp ? this.mobileApp.navigate.apply(this.mobileApp, arguments) : this.router.navigate.apply(this.router, arguments) : void console.error("Arguments Exception", "Page is empty; Usage: navigate(String page)") : void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)") }, replace: function (e) { return this.router ? "string" == $.type(e) && $.trim(e).length > 0 ? this.mobileApp ? this.mobileApp.replace.apply(this.mobileApp, arguments) : this.router.replace.apply(this.router, arguments) : void console.error("Arguments Exception", "Page is empty; Usage: replace(String page)") : void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)") }, load: function (e, n, t, r) { var o = this, i = this._renderer; return (r instanceof _renderer || r instanceof _renderer_Kendo) && (i = r), "string" == $.type(n) && $.trim(n).length > 0 && "object" == $.type(e) ? _.handleModuleHook(this.modules, "beforeLoad", [e, n, t]).then(function () { return o.trigger("before-load", [e, n, t]), $.when(i.render.apply(i, [e, n, t])).fail(function () { console.error("mokuso error loading", arguments) }) }).then(function () { return _.handleModuleHook(o.modules, "afterLoad", [e, n, t]).then(function () { o.trigger("after-load", [e, n, t]) }) }) : void console.error("Arguments Exception", "Page is empty or node is not a DOM element; Usage: load(String page, DomNode node)") }, showLoading: function () { this.mobileApp ? this.mobileApp.showLoading() : kendo.ui.progress(this.options.node, !0) }, hideLoading: function () { kendo.ui.progress(this.options.node, !1), this.mobileApp && this.mobileApp.hideLoading() }, bind: function (e, n) { "string" == $.type(e) && $.trim(e).length > 0 && $.isFunction(n) ? this.mobileApp ? this.mobileApp.bind.apply(this.mobileApp, arguments) : this._events.bind.apply(this._events, arguments) : console.error("Arguments Exception", "Event is empty or method is not a function; Usage: bind(String event, Function method, ...)") }, trigger: function (e) { "string" == $.type(e) && $.trim(e).length > 0 ? this.mobileApp ? this.mobileApp.trigger.apply(this.mobileApp, arguments) : this._events.trigger.apply(this._events, arguments) : console.error("Arguments Exception", "Event is empty ; Usage: bind(String event, ...)") } }); kendo.isArray = _.isArray, kendo.isObservableObject = _.isObservableObject, kendo.mobile && (kendo.mobile.isArray = _.isArray, kendo.mobile.isObservableObject = _.isObservableObject), Class.Renderer = _renderer, Class.Resolver = _resolver, Class.Module = kendo.Class.extend({ beforeInit: function (e) { }, afterInit: function (e) { }, beforeNavigate: function (e, n, t) { }, afterNavigate: function (e, n, t) { }, beforeLoad: function (e, n, t) { }, afterLoad: function (e, n, t) { } }), Class.GlobalMobileModels = {}, window.mokuso = Class, "function" == typeof define && define.amd ? define(function () { return Class }) : "undefined" != typeof module && module.exports && (module.exports = Class) }();