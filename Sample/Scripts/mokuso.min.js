!function(){var _={base:function(){this.init&&this.init.apply(this,arguments)},map:function(e,n){for(var t=[],o=0;o<e.length;o++)t.push(n(e[o]));return t},merge:function(e,n){for(var t=0;t<n.length;t++)e.push(n[t]);return e},grep:function(e,n){for(var t=[],o=0;o<e.length;o++)n(e[o],o)&&t.push(e[o]);return t},extend:function(e,n){return $.extend(!0,e,n)},trim:function(e){return(e||"").replace(/(^\s+|\s+$)/g,"")},type:function(e){return typeof e},promise:function(){return $.Deferred()},when:function(){return $.when.apply($,arguments)},isArray:function(e){return e instanceof Array?!0:e&&_.isFunction(e.shift)&&_.isFunction(e.slice)&&_.isFunction(e.pop)?!0:!1},isFunction:function(e){return"function"===_.type(e)},isPlainObject:function(e){return"object"==_.type(e)&&!_.isArray(e)},isObservableObject:function(e){return e&&"string"===_.type(e.uid)&&_.isFunction(e.get)&&_.isFunction(e.set)?!0:!1},ajax:function(){return $.ajax.apply($,arguments)},handleModuleHook:function(e,n,t){for(var o=[],i=0;i<e.length;i++)_.isFunction(e[i][n])&&o.push(e[i][n].apply(e[i][n],t||[]));return _.when.apply(null,o)},findNestedViews:function(_node,_parentModel,_renderer){var _defs=[];return _node.find("*[data-role='mokusoview']").addBack("*[data-role='mokusoview']").each(function(i,n){var _n=$(n),_view=_n.attr("data-view"),_args=new kendo.data.ObservableObject({});if(_.trim(_n.attr("data-view-args")).length){var arrBindFields=[],__args={},___args=_n.attr("data-view-args");_parentModel&&___args.replace(new RegExp(":\\s?([a-zA-Z_]{1,})","gi"),": _parentModel.$1");try{eval("__args = "+___args)}catch(ex){console.error("Argument Parsing Error","Could not parse inline page arguments: "+_n.attr("data-view-args"))}for(var fProp in __args){var _type=_.type(__args[fProp]);if("string"==_type||"number"==_type||"object"==_type)_args.set(fProp,__args[fProp]);else for(var tProp in _parentModel)if(__args[fProp]===_parentModel[tProp]){arrBindFields.push({f:fProp,t:tProp}),_args.set(fProp,_parentModel.get(tProp));break}}arrBindFields.length&&_parentModel.bind("change",function(e){for(var n=0;n<arrBindFields.length;n++)if(arrBindFields[n].t==e.field){_args.set(arrBindFields[n].t,this.get(e.field));break}})}_defs.push(_renderer.render(_n,_view,_args))}),_.when.apply($,_defs)},createRenderer:function(e,n,t){var o=_.type(e);if("object"===o&&_.isFunction(t.init)&&_.isFunction(t.render)){if(e=new e(n,t),e instanceof _renderer)return e}else if("string"===o)switch(e.toLowerCase()){case"kendomobile":return new _renderer_KendoMobile(n,t);case"react":return new _renderer_React(n,t);case"knockout":return new _renderer_Knockout(n,t)}return new _renderer_Kendo(n,t)},createResolver:function(e,n){var t=_.type(e);if("object"===t&&_.isFunction(e.init)&&_.isFunction(e.resolve)){if(e=new e(n),e instanceof _resolver)return e}else if("string"===t)switch(e.toLowerCase()){case"browserify":return new _renderer_Browserify(n)}return new _resolver_RequireJS(n)}};_.base.extend=function(e){var n=this,t=function(){},o=e&&e.init?e.init:function(){n.apply(this,arguments)};t.prototype=n.prototype,o.extend=n.extend,o.fn=o.prototype=new t,o.fn.constructor=o;for(var i in e)null!=e[i]&&"object"===_.type(e[i].constructor)?o.fn[i]=_.extend(_.extend({},t.prototype[i]),e[i]):o.fn[i]=e[i];return o};var _renderer=_.base.extend({options:{},resolver:null,init:function(e,n){this.options=e,this.resolver=n},render:function(e,n,t){},destroy:function(e){}}),_renderer_Kendo=_renderer.extend({render:function(e,n,t){if(!("string"!=_.type(n)||_.trim(n).length<=0||"object"!=_.type(e))){var o=this,i=_.promise(),r=n.indexOf("?"),s=r>0?n.substring(0,r):n,a=_.isObservableObject(t)?t:new kendo.data.ObservableObject(_.isPlainObject(t)?t:{}),l=e;e instanceof $||(l=$(e));var u=null,d=null,p=this._isMainContentSwitch(l);p&&(u=p.element.find("*[data-role^='mokuso']:first").data("mokusoView"),u&&"undefined"!=_.type(u.__mokuso_deinit)?d=u.__mokuso_deinit:u&&(d=u.model.deinit(u.element),u.__mokuso_deinit=d||null));var c=function(){var e=o.resolver.resolve(o.options.paths.view+"/"+s+".html");return o.resolver.resolve(o.options.paths.viewmodel+"/"+s+".js").then(function(n){var t=kendo.observable(_.extend({preinit:function(e,n){},init:function(e,n){},__________init:function(e){return this.init(e.view.element,e.sender.params)},deinit:function(e){}},n));return e.then(function(e){return o._wireTogether(l,s,a,e,t,i)}).fail(function(){i.rejectWith(null,arguments)})}).fail(function(){i.rejectWith(null,arguments)})};return u&&u.__mokuso_deinit?u.__mokuso_deinit.then(c).fail(function(){u.__mokuso_deinit=void 0,i.rejectWith(null,arguments)}):c(),i}},destroy:function(e){var n=null,t=[],o=e.find("*[data-role='mokusoview']");if(e.data("mokusoView")&&o.push(e),o.length){var i=_.promise();n=_.promise();var r=_.map(o,function(e){var n=$(e);return{depth:n.parents().length,node:n}}).sort(function(e,n){return n.depth-e.depth}).reduce(function(e,n,o,i){return e.then(function(){var e=n.node.data("mokusoView");return e&&"undefined"===_.type(e.__mokuso_deinit)?(t.push(e),e.model.deinit(n.node)):void 0})},i);r.then(function(){for(var o=0;o<t.length;o++){t[o].destroy();for(var i in t[o].model)t[o].model[i]=null}e.empty(),n.resolve()}).fail(function(){n.reject()}),i.resolve()}return null===n&&(n=_.promise().resolve()),n},_initView:function(e,n){var t=this;return e.__initedView?$.Deferred().resolve():(e.__initedView=!0,_.when(e.model.init(e.element,n)).then(function(){return _.findNestedViews(e.element.children(),e.model,t)}))},_wireTogether:function(e,n,t,o,i,r){var s=this,a=new kendo.View("<div>"+o+"</div>",{model:i,init:function(){this.element.data("mokusoView",this),this.element.attr("data-role","mokusoview"),this.element.attr("data-view",n)},show:function(e){if(!s.options.transition||!e.sender.element.closest(s.options.node).length||!e.sender.element.siblings("[data-role=mokusoview]").length){var n=this;setTimeout(function(){s._initView(n,t).then(function(){r.resolve()}).fail(function(){r.rejectWith(null,arguments)})})}},transitionStart:function(n){n.sender.element.data("_prevHeight",n.sender.element.css("height")).data("_prevWidth",n.sender.element.css("width")),n.sender.element.height(e.height()).width(e.width())},transitionEnd:function(e){if(e.sender.element.css("height",e.sender.element.data("_prevHeight")).css("width",e.sender.element.data("_prevWidth")),"hide"!=e.type||e.sender.___destroying){if("show"==e.type&&s.options.transition){var n=this;setTimeout(function(){s._initView(n,t).then(function(){r.resolve()}).fail(function(){r.rejectWith(null,arguments)})},250)}}else e.sender.___destroying=!0,setTimeout(function(){s.destroy(e.sender.element)},250)},hide:function(e){e.sender.___destroying||(e.sender.___destroying=!0,s.destroy(e.sender.element))},wrap:!1});return _.when(i.preinit(e,t)).then(function(){e.removeAttr("data-role"),e.removeAttr("data-view"),e.removeAttr("data-view-args");var n=s._isMainContentSwitch(e);n?n.showIn("#mokusoLayoutNode",a,s.options.transition):a.render(e)})},_isMainContentSwitch:function(e){var n=e.parents("*[data-role^='mokuso']:first").data("mokusoLayout");return n instanceof kendo.Layout?n:!1}}),_renderer_KendoMobile=_renderer_Kendo.extend({_wireTogether:function(e,n,t,o,i,r){var s=this;if(e.parent().is("[data-mokuso-content-node]")){var a=$(o),l="a"+kendo.guid().replace(new RegExp("-","g"),"");return window.mokuso.GlobalMobileModels[l]=i,a.each(function(e){var n=$(this),t=_.trim(n.attr("data-role")||"").toLowerCase();if(t.length&&(n.attr("data-model","mokuso.GlobalMobileModels."+l),"view"==t)){var o=(n.attr("data-bind")||"").replace(new RegExp("events([ ]{0,}):([ ]{0,}){","i"),"events:{"),i=o.indexOf("events:{");i>-1?n.attr("data-bind",o.substring(0,i+8)+" init: __________init, "+o.substring(i+8,o.length)):n.attr("data-bind",_.merge(o.length?o.split(","):[],["events: { init: __________init }"]).join(","))}}),_.when(i.preinit(e,t)).then(function(){var n=a.insertAfter(e);return _.findNestedViews(n,i,s).then(function(){r.resolve()}).fail(function(){r.rejectWith(null,arguments)})})}return _renderer_Kendo.fn._wireTogether.apply(s,arguments)}}),_renderer_React=_renderer.extend({render:function(e,n,t){var o=_.promise();return this.resolver.resolve(this.options.paths.view+"/"+n+".js").then(function(n){React.unmountComponentAtNode(e[0]),React.render(n,e[0],function(){o.resolve()})}).fail(function(){o.rejectWith(null,arguments)}),o}}),_renderer_Knockout=_renderer.extend({render:function(e,n,t){var o=_.promise();return _.when(this.resolver.resolve(this.options.paths.view+"/"+n+".html"),this.resolver.resolve(this.options.paths.viewmodel+"/"+n+".js")).then(function(n,t){for(var o in t)_.isArray(t[o])?t[o]=ko.observableArray(t[o]):_.isFunction(t[o])||(t[o]=ko.observable(t[o]));ko.cleanNode(e[0]),e.html(n),ko.applyBindings(t,e[0])}).fail(function(){o.rejectWith(null,arguments)}),o}}),_resolver=_.base.extend({options:null,init:function(e){this.options=e},resolve:function(e){throw"resolver didnt provide a resolve method."}}),_resolver_JQuery=_resolver.extend({resolve:function(e){var n=null;return n=e.match("js$")?_.ajax({url:e,dataType:"script"}).promise():_.ajax({url:e}).promise()}}),_resolver_RequireJS=_resolver.extend({cache:{},resolve:function(e){var n=null;if(e.match("js$"))n=_.promise(),require([e.replace(new RegExp(".js$"),"")],function(e){n.resolveWith(null,[e])},function(){n.rejectWith(null,arguments)});else if(this.cache[e])n=_.promise().resolveWith(null,[this.cache[e]]);else{var t=this;n=_.ajax({url:require.toUrl(e),success:function(n){t.cache[e]=n}}).promise()}return n}}),_resolver_Browserify=_resolver.extend({resolve:function(e){var n=null;return n=e.match(".js$")?_.promise().resolveWith(null,[require(e.replace(new RegExp(".js$"),""))]):_.ajax({url:e}).promise()}}),_module=_.base.extend({beforeInit:function(e){},afterInit:function(e){},beforeNavigate:function(e,n,t){},afterNavigate:function(e,n,t){},beforeLoad:function(e,n,t){},afterLoad:function(e,n,t){}}),_framework={options:{},events:["init","before-navigate","after-navigate","before-load","after-load"],router:null,mobileApp:null,modules:[],isAppReady:!1,_eventsBuffer:[],_events:$({}),_renderer:null,_resolver:null,init:function(e,n,t){var o=this;this.options=_.extend({node:$("body"),initial:null,init:null,transition:"swap",root:"/",pushState:!1,hashBang:!1,modules:[],paths:{view:"view",viewmodel:"viewmodel"},renderer:"kendo",resolver:"requirejs"},n),e&&(e instanceof $||(e=$(e)),this.options.node=e);for(var i=0;i<this.options.modules.length;i++)this.registerModule(this.options.modules[i]);o._resolver=_.createResolver(o.options.resolver,o.options),o._renderer=_.createRenderer(o.options.renderer,o.options,o._resolver),_.handleModuleHook(this.modules,"beforeInit",[this]).then(function(){if(o.options.node.attr("data-mokuso-content-node",!0),t&&kendo.mobile&&kendo.mobile.Application){var i=_.promise(),r=_.createRenderer("kendomobile",o.options,o._resolver);return o.options.transition&&"swap"!==o.options.transition.toLowerCase()||(o.options.transition="slide"),"string"==_.type(o.options.initial)&&_.trim(o.options.initial).length>0?o.load(o.options.node,n.initial,{},r).then(function(){o.options.node.prepend(o.options.node.find(">*[data-role='mokusoview']").data("mokusoView").element.children()),o.mobileApp=new kendo.mobile.Application(o.options.node,_.extend(_.extend({},o.options),{initial:null})),app.applyQueuedEvents(),i.resolve()}):_.findNestedViews(o.options.node,null,r).then(function(){o.mobileApp=new kendo.mobile.Application(o.options.node,_.extend(_.extend({},o.options),{})),app.applyQueuedEvents(),i.resolve()}).progress(function(){}).fail(function(){}),_.when(i).then(function(){o.router=o.mobileApp.router,kendo.ui.progress=function(e,n){var t=kendo.widgetInstance(e.closest(".km-pane").addBack(".km-pane"));t&&t.loader?(n?t.loader.show():t.loader.hide(),n||t.element.find(".k-loading-mask").remove()):(n?o.mobileApp.showLoading():o.mobileApp.hideLoading(),n||o.options.node.find(".k-loading-mask").remove())},o.router.bind("change",function(e){o.trigger("before-navigate",[e.url,o.options.node]),_.handleModuleHook(o.modules,"beforeNavigate",[o.options.node,e.url]),setTimeout(function(){o.trigger("after-navigate",[e.url,o.options.node]),_.handleModuleHook(o.modules,"afterNavigate",[o.options.node,e.url])},10)})})}o.isAppReady=!0,o.router=new kendo.Router({pushState:o.options.pushState,hashBang:o.options.hasBang,root:o.options.root}),o.router.route("*page",function(e,n){return _.trim(e.replace("/","")).length?_.handleModuleHook(o.modules,"beforeNavigate",[o.options.node,e,n]).always(function(){return o.trigger("before-navigate",[e,o.options.node]),_.when(o._renderer.render(o.options.node,e,n)).fail(function(e){o.router.trigger("routeMissing",e)})}).always(function(){return o.trigger("after-navigate",[e,o.options.node]),_.handleModuleHook(o.modules,"afterNavigate",[o.options.node,e,n])}):void 0});var s=new kendo.Layout("<div id='mokusoLayoutNode'></div>",{wrap:!1});s.render(e),o.options.node=e.find("#mokusoLayoutNode"),e.attr("data-role","mokusolayout"),e.data("mokusoLayout",s);var a=location.href.indexOf("#");_.trim(o.options.initial).length&&(0>a||a==location.href.length-1)&&(0>a?location.href=location.href+"#"+o.options.initial:location.href=location.href.substring(0,a)+"#"+o.options.initial)}).then(function(){return _.handleModuleHook(o.modules,"afterInit",[o]).then(function(){o.mobileApp||o.router.start(),_.isFunction(o.options.init)&&o.options.init(o)})})},registerModule:function(e){e instanceof _module&&0===_.grep(this.modules,function(n){return e===n}).length?this.modules.push(e):console.error("Module is not an extension of mokuso.Module")},deregisterModule:function(e){e instanceof _module&&_.grep(this.modules,function(n){return e===n}).length>=1?this.modules=_.grep(function(e){return e!==e}):console.error("Module is not an extension of mokuso.Module")},navigate:function(e,n){return this.router?"string"==_.type(e)&&_.trim(e).length>0?this.mobileApp?this.mobileApp.navigate.apply(this.mobileApp,arguments):this.router.navigate.apply(this.router,arguments):void console.error("Arguments Exception","Page is empty; Usage: navigate(String page)"):void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)")},replace:function(e){return this.router?"string"==_.type(e)&&_.trim(e).length>0?this.mobileApp?this.mobileApp.replace.apply(this.mobileApp,arguments):this.router.replace.apply(this.router,arguments):void console.error("Arguments Exception","Page is empty; Usage: replace(String page)"):void console.error("App not initialized: call initialize(DomNode contentNode, JSON options)")},load:function(e,n,t,o){var i=this,r=this._renderer;return(o instanceof _renderer||o instanceof _renderer_Kendo)&&(r=o),"string"==_.type(n)&&_.trim(n).length>0&&"object"==_.type(e)?_.handleModuleHook(this.modules,"beforeLoad",[e,n,t]).then(function(){return i.trigger("before-load",[e,n,t]),_.when(r.render.apply(r,[e,n,t])).fail(function(){console.error("mokuso error loading",arguments)})}).then(function(){return _.handleModuleHook(i.modules,"afterLoad",[e,n,t]).then(function(){i.trigger("after-load",[e,n,t])})}):void console.error("Arguments Exception","Page is empty or node is not a DOM element; Usage: load(String page, DomNode node)")},showLoading:function(){this.mobileApp?this.mobileApp.showLoading():kendo.ui.progress(this.options.node,!0)},hideLoading:function(){kendo.ui.progress(this.options.node,!1),this.mobileApp&&this.mobileApp.hideLoading()},bind:function(e,n){"string"==_.type(e)&&_.trim(e).length>0&&_.isFunction(n)?this.isAppReady?this.mobileApp?this.mobileApp.bind.apply(this.mobileApp,arguments):this._events.bind.apply(this._events,arguments):this._eventsBuffer.push({event:e,method:n}):console.error("Arguments Exception","Event is empty or method is not a function; Usage: bind(String event, Function method, ...)")},applyQueuedEvents:function(){app.isAppReady=!0,$.each(app._eventsBuffer,function(e,n){app.bind(n.event,n.method)}),app._eventsBuffer=[]},unbind:function(e,n){"string"==_.type(e)&&_.trim(e).length>0&&_.isFunction(n)?this.mobileApp?this.mobileApp.unbind.apply(this.mobileApp,arguments):this._events.unbind.apply(this._events,arguments):console.error("Arguments Exception","Event is empty or method is not a function; Usage: bind(String event, Function method, ...)")},trigger:function(e){"string"==_.type(e)&&_.trim(e).length>0?this.mobileApp?this.mobileApp.trigger.apply(this.mobileApp,arguments):this._events.trigger.apply(this._events,arguments):console.error("Arguments Exception","Event is empty ; Usage: bind(String event, ...)")}};window.mokuso=function(){_.extend(this,_framework),kendo&&(kendo.isArray=_.isArray,kendo.isObservableObject=_.isObservableObject,kendo.mobile&&(kendo.mobile.isArray=_.isArray,kendo.mobile.isObservableObject=_.isObservableObject)),this.init.apply(this,arguments)},window.mokuso.Renderer=_renderer,window.mokuso.Resolver=_resolver,window.mokuso.Module=_module,window.mokuso.GlobalMobileModels={},"function"==typeof define&&define.amd?define("mokuso",[],function(){return window.mokuso}):"undefined"!=typeof module&&module.exports&&(module.exports=window.mokuso)}();